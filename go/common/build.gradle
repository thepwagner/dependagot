task protoc(type: Exec, dependsOn: ':go:protoc:build') {
  def protoDir = project(':proto').projectDir.toPath()
  def protos = fileTree(dir: protoDir, include: '**/*.proto')
  executable "docker"
  args = [
    "run", "--rm", "--net=none",
    "-v", "${protoDir}:/work/src",
    "-v", "${projectDir}:/work/out",
    "-w", "/work",
    images.protocGo,
    protos.collect { "src/${protoDir.relativize(it.toPath())}" }.join(' ')
  ]

  inputs.files protos
  outputs.files fileTree(dir: projectDir, include: '**/*_pb.go')
}